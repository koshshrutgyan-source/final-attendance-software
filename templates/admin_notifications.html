<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Notifications</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; margin:0; background:#f4f6f9; }
        .container { max-width:900px; margin:40px auto; background:#fff; padding:30px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
        h2 { margin-top:0; }
        .form-group { margin-bottom:15px; }
        label { display:block; margin-bottom:5px; font-weight:600; }
        input[type=text], select, textarea { width:100%; padding:10px; border-radius:6px; border:1px solid #ccc; }
        button { padding:10px 20px; background:#007BFF; color:white; border:none; border-radius:6px; font-weight:600; cursor:pointer; }
        button:hover { background:#0056b3; }
        .notification { background:#f1f5f9; padding:12px; border-radius:6px; margin-bottom:10px; }
        .flash { margin-bottom:20px; padding:10px; border-radius:6px; font-weight:bold; }
        .flash-success { background:#d4edda; color:#155724; }
        .flash-danger { background:#f8d7da; color:#721c24; }
    </style>
    <script>
        function toggleEmployeeDropdown() {
            var recipient = document.querySelector('input[name="recipient"]:checked').value;
            var dropdown = document.getElementById('employee-select');
            dropdown.style.display = recipient === 'selected' ? 'block' : 'none';
        }
    </script>
</head>
<body>
    <div class="container">
        <h2>Send Notification / Alert</h2>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="flash flash-{{ category }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form method="POST">
            <div class="form-group">
                <label>Message:</label>
                <textarea name="message" rows="3" required></textarea>
            </div>

            <div class="form-group">
                <label>Recipient:</label>
                <input type="radio" name="recipient" value="all" checked onchange="toggleEmployeeDropdown()"> All Employees
                <input type="radio" name="recipient" value="selected" onchange="toggleEmployeeDropdown()"> Selected Employee
            </div>

            <div class="form-group" id="employee-select" style="display:none;">
                <label>Select Employee:</label>
                <select name="employee_id">
                    <option value="">--Select Employee--</option>
                    {% for emp in employees %}
                        <option value="{{ emp.id }}">{{ emp.name }} ({{ emp.emp_id }})</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit">Send Notification</button>
        </form>

        <hr style="margin:30px 0;">

        <h2>Sent Notifications</h2>
        {% if notifications %}
            {% for note in notifications %}
                <div class="notification">
                    <p>{{ note.message }}</p>
                    <small>
                        {% if note.employee_id %}
                            To: {{ note.employee.name }} |
                        {% else %}
                            To: All Employees |
                        {% endif %}
                        {{ note.timestamp.strftime("%Y-%m-%d %H:%M") }}
                    </small>
                </div>
            {% endfor %}
        {% else %}
            <p>No notifications sent yet.</p>
        {% endif %}
    </div>
</body>
</html>